const PC_PREFIX="https://alicdn.dingzh.cc/ding-BlogDemo/img/pcBg/pc_bg",PHONE_PREFIX="https://alicdn.dingzh.cc/ding-BlogDemo/img/phoneBg/phone_bg",PC_MAX=384,PHONE_MAX=200,BG_ID="web_bg",KEY_PC="bg.url.pc",KEY_MO="bg.url.mobile";function isMobile(){const e=navigator.userAgentData?.mobile;if(!0===e)return!0;const n=Math.min(window.innerWidth||0,screen.width||0),t=window.matchMedia?.("(pointer: coarse)")?.matches??!1;return n<=480||(!!(t&&n<=600)||/Android|iPhone|Windows Phone|Mobi/i.test(navigator.userAgent))}function pickRandomUrl(e){const n=Math.floor(Math.random()*(e?200:384))+1;return(e?PHONE_PREFIX:PC_PREFIX)+n+".jpg"}function getEl(){return document.getElementById(BG_ID)||document.body}function getCurrentBgUrl(e){const n=getComputedStyle(e).backgroundImage,t=n&&n.match(/url\(["']?(.*?)["']?\)/i);return t?t[1]:""}function preload(e){return e?(window.__bg_preload_img__=window.__bg_preload_img__||new Image,new Promise((n=>{const t=window.__bg_preload_img__;if(t.src===e&&t.complete)return n();t.onload=t.onerror=()=>n(),t.src=e}))):Promise.resolve()}function apply(e){const n=getEl();n&&getCurrentBgUrl(n)!==e&&(n.style.backgroundImage=`url("${e}")`)}function isHardReload(){const e=performance.getEntriesByType?.("navigation")?.[0];return!!e&&"reload"===e.type}function ensureElThen(e){if(getEl())return void e();let n=0;const t=setInterval((()=>{(getEl()||++n>40)&&(clearInterval(t),e())}),50)}if(window.__random_bg_inited__){const e=isMobile()?KEY_MO:KEY_PC,n=sessionStorage.getItem(e);ensureElThen((()=>{const e=getEl();n&&e&&getCurrentBgUrl(e)!==n&&apply(n)}))}else{window.__random_bg_inited__=!0,ensureElThen((async()=>{const e=isMobile(),n=e?KEY_MO:KEY_PC;let t=sessionStorage.getItem(n);if(!t||isHardReload()){t=pickRandomUrl(e),sessionStorage.setItem(n,t),await preload(t);const o=document.createElement("link");o.rel="preload",o.as="image",o.href=t,document.head&&document.head.appendChild(o)}apply(t)}));const e=()=>{const e=isMobile()?KEY_MO:KEY_PC,n=sessionStorage.getItem(e),t=getEl();n&&t&&getCurrentBgUrl(t)!==n&&apply(n)};document.addEventListener("pjax:complete",e),document.addEventListener("pjax:success",e),document.addEventListener("pjax:end",e),window.addEventListener("pageshow",(n=>{n.persisted&&e()}))}window.changeBackground=async function(){const e=isMobile(),n=e?KEY_MO:KEY_PC,t=pickRandomUrl(e);sessionStorage.setItem(n,t),await preload(t),apply(t)};