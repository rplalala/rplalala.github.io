const PC_PREFIX="https://alicdn.dingzh.cc/ding-BlogDemo/img/pcBg/pc_bg",PHONE_PREFIX="https://alicdn.dingzh.cc/ding-BlogDemo/img/phoneBg/phone_bg",PC_MAX=384,PHONE_MAX=200,BG_ID="web_bg",KEY_PC="bg.url.pc",KEY_MO="bg.url.mobile",MODE_RANDOM="random",MODE_WHITE="white",MODE_BLACK="black",MODE_SEQUENCE=["white","black","random"],MODE_STORAGE_KEY="bg.manual.mode";function isValidMode(e){return"random"===e||"white"===e||"black"===e}function readStoredMode(){try{const e=localStorage.getItem("bg.manual.mode");return isValidMode(e)?e:"random"}catch(e){return"random"}}function getMode(){const e=window.__bg_override_mode__;return isValidMode(e)?e:"random"}function persistMode(e){const t=isValidMode(e)?e:"random";window.__bg_override_mode__=t;try{"random"===t?localStorage.removeItem("bg.manual.mode"):localStorage.setItem("bg.manual.mode",t)}catch(e){}return t}function updateModeButton(e){const t=document.getElementById("cycle-bg-mode-btn");if(!t)return;t.__baseTitle||(t.__baseTitle=t.getAttribute("data-title-base")||t.title||"");const o="white"===e?"data-white-label":"black"===e?"data-black-label":"data-random-label",n=o?t.getAttribute(o):"";t.title=n?`${t.__baseTitle} (${n})`:t.__baseTitle,t.setAttribute("data-mode",e)}function isMobile(){const e=navigator.userAgentData?.mobile;if(!0===e)return!0;const t=Math.min(window.innerWidth||0,screen.width||0),o=window.matchMedia?.("(pointer: coarse)")?.matches??!1;return t<=480||(!!(o&&t<=600)||/Android|iPhone|Windows Phone|Mobi/i.test(navigator.userAgent))}function pickRandomUrl(e){const t=Math.floor(Math.random()*(e?200:384))+1;return(e?PHONE_PREFIX:PC_PREFIX)+t+".jpg"}function getEl(){return document.getElementById(BG_ID)||document.body}function syncModeToDom(e){const t=getEl();if(!t)return;const o=getMode();if("random"===o){if(t.style.removeProperty("background-color"),e){const e=isMobile()?KEY_MO:KEY_PC,t=sessionStorage.getItem(e);t&&apply(t)}}else t.style.backgroundImage="none",t.style.backgroundColor="white"===o?"#ffffff":"#000000";updateModeButton(o)}function getCurrentBgUrl(e){const t=getComputedStyle(e).backgroundImage,o=t&&t.match(/url\(["']?(.*?)["']?\)/i);return o?o[1]:""}function preload(e){return e?(window.__bg_preload_img__=window.__bg_preload_img__||new Image,new Promise((t=>{const o=window.__bg_preload_img__;if(o.src===e&&o.complete)return t();o.onload=o.onerror=()=>t(),o.src=e}))):Promise.resolve()}function apply(e){const t=getEl();t&&"random"===getMode()&&getCurrentBgUrl(t)!==e&&(t.style.backgroundImage=`url("${e}")`)}function isHardReload(){const e=performance.getEntriesByType?.("navigation")?.[0];return!!e&&"reload"===e.type}function ensureElThen(e){if(getEl())return void e();let t=0;const o=setInterval((()=>{(getEl()||++t>40)&&(clearInterval(o),e())}),50)}if(isValidMode(window.__bg_override_mode__)||(window.__bg_override_mode__=readStoredMode()),updateModeButton(getMode()),window.__random_bg_inited__){const e=isMobile()?KEY_MO:KEY_PC,t=sessionStorage.getItem(e);ensureElThen((()=>{const e=getEl();"random"===getMode()&&t&&e&&getCurrentBgUrl(e)!==t&&apply(t),syncModeToDom(!1)}))}else{window.__random_bg_inited__=!0,ensureElThen((async()=>{const e=isMobile(),t=e?KEY_MO:KEY_PC;let o=sessionStorage.getItem(t);if(!o||isHardReload()){o=pickRandomUrl(e),sessionStorage.setItem(t,o),await preload(o);const n=document.createElement("link");n.rel="preload",n.as="image",n.href=o,document.head&&document.head.appendChild(n)}"random"===getMode()&&apply(o),syncModeToDom(!1)}));const e=()=>{if("random"===getMode()){const e=isMobile()?KEY_MO:KEY_PC,t=sessionStorage.getItem(e),o=getEl();t&&o&&getCurrentBgUrl(o)!==t&&apply(t)}syncModeToDom(!1)};document.addEventListener("pjax:complete",e),document.addEventListener("pjax:success",e),document.addEventListener("pjax:end",e),window.addEventListener("pageshow",(t=>{t.persisted&&e()}))}window.changeBackground=async function(){const e=isMobile(),t=e?KEY_MO:KEY_PC,o=pickRandomUrl(e);sessionStorage.setItem(t,o),await preload(o),apply(o)},window.cycleBackgroundMode=function(e){const t=getMode(),o=MODE_SEQUENCE.indexOf(t);persistMode(MODE_SEQUENCE[(o+1)%MODE_SEQUENCE.length]),syncModeToDom(!0),e&&"function"==typeof e.blur&&e.blur()};